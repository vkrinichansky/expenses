<div *ngIf="(flow$ | async) === undefined" class="choose-action">
  <span class="title text-beige">{{ dictionary.CategoryManagement }}</span>
  <div class="choose-action__buttons">
    <app-button (click)="changeFlow(flows.AddCategory)">
      {{ dictionary.Add }}
    </app-button>
    <app-button (click)="changeFlow(flows.RemoveCategory)">
      {{ dictionary.Remove }}
    </app-button>
  </div>
</div>

<form *ngIf="(flow$ | async) === flows.AddCategory && !(isConfirmationOpen$ | async)" [formGroup]="addForm">
  <span class="title text-beige">{{ dictionary.Add }}</span>
  <select formControlName="table">
    <option *ngFor="let table of tables">{{ table }}</option>
  </select>

  <input formControlName="category" type="text" [placeholder]="dictionary.AddCategoryPlaceholder" />
  <app-button [disabled]="addForm.invalid" (click)="openConfirmation()">
    {{ dictionary.Add }}
  </app-button>
  <app-button (click)="resetFlow()">
    {{ dictionary.GoBack }}
  </app-button>
</form>

<form *ngIf="(flow$ | async) === flows.RemoveCategory && !(isConfirmationOpen$ | async)" [formGroup]="removeForm">
  <span class="title text-beige">{{ dictionary.Remove }}</span>
  <select formControlName="table">
    <option *ngFor="let table of tables">{{ table }}</option>
  </select>
  <select
    formControlName="category"
    [ngClass]="{
      disabled: !categories.length
    }"
  >
    <option *ngFor="let category of categories">
      {{ category }}
    </option>
  </select>
  <app-button [disabled]="removeForm.invalid" (click)="openConfirmation()">
    {{ dictionary.Remove }}
  </app-button>
  <app-button (click)="resetFlow()">
    {{ dictionary.GoBack }}
  </app-button>
</form>

<div *ngIf="isConfirmationOpen$ | async" class="confirmation">
  <ng-container
    *ngTemplateOutlet="(flow$ | async) === flows.AddCategory ? addConfirmation : removeConfirmation"
  ></ng-container>
</div>

<ng-template #addConfirmation>
  <app-confirmation (confirmChoice)="$event ? addCategory() : closeConfirmation()">
    Добавить <span class="bold">{{ addForm.value.category }}</span> в таблицу
    <span class="bold">{{ addForm.value.table }}</span
    >?
  </app-confirmation>
</ng-template>

<ng-template #removeConfirmation>
  <app-confirmation (confirmChoice)="$event ? removeCategory() : closeConfirmation()">
    Удалить <span class="bold">{{ removeForm.value.category }}</span> из таблицы
    <span class="bold">{{ removeForm.value.table }}</span
    >?
  </app-confirmation>
</ng-template>
